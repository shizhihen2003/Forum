<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.edu.ujn.Forum.dao.FanMapper">

  <!-- 插入关注记录 -->
  <insert id="insertFollow">
    INSERT INTO fans (fan_id, author_id, created_at)
    VALUES (#{fanId}, #{authorId}, NOW())
  </insert>

  <!-- 删除关注记录 -->
  <delete id="deleteFollow">
    DELETE FROM fans
    WHERE fan_id = #{fanId} AND author_id = #{authorId}
  </delete>

  <!-- 检查是否已关注 -->
  <select id="isFollowing" resultType="int">
    SELECT COUNT(1)
    FROM fans
    WHERE fan_id = #{fanId} AND author_id = #{authorId}
  </select>

  <!-- 获取用户关注的作者列表 -->
  <select id="getFollowingList" resultMap="FanResultMap">
    SELECT
    f.id,
    f.fan_id,
    f.author_id,
    f.created_at,
    u.username AS authorName,
    u.avatar AS authorAvatar
    FROM fans f
    JOIN users u ON f.author_id = u.id
    WHERE f.fan_id = #{fanId};
  </select>

  <!-- 获取某作者的粉丝列表 -->
  <select id="getFollowers" resultMap="FanResultMap">
    SELECT
    f.id,
    f.fan_id,
    f.author_id,
    f.created_at,
    u.username AS fanName,
    u.avatar AS fanAvatar
    FROM fans f
    JOIN users u ON f.fan_id = u.id
    WHERE f.author_id = #{authorId};
  </select>
  <select id="findFansByFanGroupId" resultType="cn.edu.ujn.Forum.dao.Fan">
    SELECT * FROM fans WHERE group_id = #{groupId}
  </select>

  <!-- FanResultMap 定义 -->
  <resultMap id="FanResultMap" type="cn.edu.ujn.Forum.dao.Fan">
    <id column="id" property="id"/>
    <result column="fan_id" property="fanId"/>
    <result column="author_id" property="authorId"/>
    <result column="created_at" property="createdAt"/>
    <result column="authorName" property="authorName"/>
    <result column="authorAvatar" property="authorAvatar"/>
    <result column="fanName" property="fanName"/>
    <result column="fanAvatar" property="fanAvatar"/>
  </resultMap>

</mapper>
