<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.edu.ujn.Forum.dao.LikeMapper">

    <!-- 插入点赞记录 -->
    <insert id="insertLike" parameterType="map">
        INSERT INTO likes (user_id, post_id)
        VALUES (#{userId, jdbcType=INTEGER}, #{postId, jdbcType=INTEGER})
    </insert>

    <!-- 删除点赞记录 -->
    <delete id="deleteLike" parameterType="map">
        DELETE FROM likes
        WHERE user_id = #{userId, jdbcType=INTEGER}
        AND post_id = #{postId, jdbcType=INTEGER}
    </delete>

    <!-- 查询某个帖子的点赞数 -->
    <select id="countLikesByPostId" parameterType="int" resultType="int">
        SELECT COUNT(*) FROM likes
        WHERE post_id = #{postId, jdbcType=INTEGER}
    </select>

    <!-- 查询点赞某个帖子的所有用户ID列表 -->
    <select id="findUsersByPostId" parameterType="int" resultType="int">
        SELECT user_id
        FROM likes
        WHERE post_id = #{postId, jdbcType=INTEGER}
    </select>

    <!-- 查询某个用户点赞过的所有帖子ID列表 -->
    <select id="findPostsByUserId" parameterType="int" resultType="int">
        SELECT post_id
        FROM likes
        WHERE user_id = #{userId, jdbcType=INTEGER}
    </select>

    <!-- 检查某用户是否已点赞某帖子 -->
    <select id="checkIfUserLikedPost" parameterType="map" resultType="int">
        SELECT COUNT(*)
        FROM likes
        WHERE user_id = #{userId, jdbcType=INTEGER}
        AND post_id = #{postId, jdbcType=INTEGER}
    </select>

</mapper>
